# Freebox v6

The Freebox v6 allows to access some features of the server and the TV player via REST APIs.

More details on those APIs on [mafreebox](http://mafreebox.freebox.fr/).

## Installation

### IP Address

The local ip address of the freebox may be found on [mafreebox](http://mafreebox.freebox.fr/) > Help section.

### Server token

It also needs to create a token for the plugin instance. The class `FreeboxAppTokenRequest` can be used. It is a simple Java main class which requires some configuration:
- app_id
- app_name
- app_version
- device_name

The result contains an "app_token" which has to be stored in the configuration.properties file.

The rights of this new application have to be updated, because by default it does not allow to interact with the player.

- [mafreebox](http://mafreebox.freebox.fr/)
- Freebox parameters
- Access management
- Application
- give access right to the player (false by default)

### Remote control

To allow the REST APIs to simulate a remote control, we need the remote code which can be found in  
TV > Home > parameters/configuration (on the right of the screen) > display player and server configuration > remote code

This code has to be stored in the configuration.properties file.


## Events

### Input

list of listened events: 

**FREEBOXV6_COMMAND** (Freeboxv6CommandEventData)  
event attributes:

- commands: list of commands to execute (Power on, power off, play, pause).

Allow to interact with the freebox. 

## Commands

Implemented commands:

1. freebox list: list all the players connected to the freebox server
2. freebox power: simulate the power button of the remote control
3. freebox status -player_id={player id}: retrieve the status of a given player  
{player id}: id of the player to check
4. freebox netflix: simulate several buttons of the remote control to launch the netflix app

## Implementation

It uses 2 sets of APIs

1. The freebox server: used to manage the players, retrieve its status... but it can't be used to perform some actions like play/pause or turn it on/off.  
Some services are exposed in `FreeboxServerService`. 

2. The remote control APIs - should be deprecated but still widely used. Since the server APIs does not provide us the APIs to control the player, 
we use this APIs to simulate the action of key press on the remote control buttons.
Some services are exposed in `FreeboxRemoteService`.

## Configuration

Configuration details:

- freeboxv6.remote.host: endpoint for the remote control REST API
- freeboxv6.server.player_id: id of the player - use the command to list all the player and find the right one
- freeboxv6.server.host: endpoint for accessing server REST APIs
- freeboxv6.server.app_id: application id used for the token creation (see installation section)

Secured configuration file: freebox_credentials.properties

- secret.freeboxv6.remote.code: remote code (see the installation section)
- secret.freeboxv6.server.app_token: token generated by the freebox server